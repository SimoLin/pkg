package ldap_test

import (
	"encoding/base64"
	"encoding/json"
	"fmt"
	"testing"

	"github.com/jummyliu/pkg/ldap"
	_ "github.com/jummyliu/pkg/ldap/ace"
)

func TestNewNtSecurityDescriptor(t *testing.T) {
	descBytesB64 := "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"
	descBytes, err := base64.StdEncoding.DecodeString(descBytesB64)
	if err != nil {
		t.Fatalf("ntSecurityDescriptorB64 decode failure: %s", err)
	}
	desc, err := ldap.NewNtSecurityDescriptor(descBytes)
	if err != nil {
		t.Fatalf("parse ntSecurityDescriptor failure: %s", err)
	}
	fmt.Println(desc)
	fmt.Println("------------------")
	fmt.Println(desc.NtString())
	fmt.Println("------------------")
	d, _ := json.Marshal(desc)
	fmt.Println(string(d))
}
